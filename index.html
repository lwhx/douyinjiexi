<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ å¤å“¥è§£æ âœ¨</title>
    <link href="css/css2.css" rel="stylesheet">
    <style>
        :root {
            --main-pink: #FFA1C9;
            --sky-blue: #87CEEB;
            --mint-green: #98FB98;
            --deep-purple: #9370DB;
            --bg-blur: blur(12px);
        }

        body {
            font-family: 'Kiwi Maru', serif;
            background: linear-gradient(145deg, var(--sky-blue) 0%, var(--main-pink) 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .anime-character {
            position: fixed;
            z-index: 0;
            pointer-events: none;
            max-width: 250px;
            opacity: 0.9;
        }
        .character-left { bottom: -50px; left: -30px; transform: scaleX(-1); }
        .character-right { bottom: -50px; right: -30px; }

        .widgets-container {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }

        .widget-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: var(--bg-blur);
            padding: 12px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.3s ease;
        }

        .main-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: var(--bg-blur);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            z-index: 1;
        }

        .input-box {
            position: relative;
            margin: 30px 0;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(255, 161, 201, 0.3);
        }

        #urlInput {
            width: 78%;
            padding: 18px 130px 18px 25px;
            border: none;
            background: transparent;
            font-size: 16px;
            color: #6A5ACD;
            outline: none;
        }

        #urlInput::placeholder {
            color: #C8A2C8;
        }

        .parse-btn {
            position: absolute;
            right: 5px;
            top: 5px;
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--deep-purple), var(--main-pink));
            color: white;
            border: none;
            border-radius: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .media-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .bouncing-loader {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }

        .bouncing-loader div {
            width: 12px;
            height: 12px;
            margin: 3px;
            background: var(--deep-purple);
            border-radius: 50%;
            animation: bouncing 0.6s infinite alternate;
        }

        @keyframes bouncing {
            to { transform: translateY(-15px); }
        }

        .debug-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9999;
        }

        @media (max-width: 768px) {
            .main-container {
                margin: 15px;
                padding: 25px;
            }
            .widgets-container {
                top: 10px;
                right: 10px;
                flex-direction: column;
            }
            .anime-character {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h1 style="text-align: center; color: #6A5ACD; margin-bottom: 30px;">ğŸŒ¸ å¤å“¥è§£æ ğŸŒ¸</h1>

        <div class="input-box">
            <input type="text" placeholder="åœ¨è¿™é‡Œè¾“å…¥è§†é¢‘é“¾æ¥å“¦ï½ (à¸…^â€¢Ï‰â€¢^à¸…)" id="urlInput">
            <button class="parse-btn" onclick="parseContent()">
                <i class="fas fa-wand-magic-sparkles"></i>
                é­”æ³•è§£æï¼
            </button>
        </div>

        <div class="loading" id="loading" style="display: none;">
            <div class="bouncing-loader">
                <div></div>
                <div></div>
                <div></div>
            </div>
            <p style="text-align: center; color: #6A5ACD; margin-top: 10px;">æ­£åœ¨æ–½å±•è§£æé­”æ³•... âœ¨</p>
        </div>

        <div id="contentBox" style="opacity: 0; transition: opacity 0.3s ease;"></div>
    </div>

    <div class="debug-info" id="debugInfo"></div>

    <script>
        // è°ƒè¯•ä¿¡æ¯æ˜¾ç¤º
        let debugTimer;
        function showDebugInfo(message) {
            const debugEl = document.getElementById('debugInfo');
            debugEl.textContent = message;
            clearTimeout(debugTimer);
            debugTimer = setTimeout(() => debugEl.textContent = '', 5000);
        }

        setInterval(updateTime, 1000);
        updateTime();

        getWeather();

        // URLæå–
        function extractURL(text) {
            try {
                const urlRegex = /(https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&\/=]*))/g;
                const matches = text.match(urlRegex);
                return matches ? matches[0] : null;
            } catch (e) {
                console.error('URLæå–é”™è¯¯:', e);
                return null;
            }
        }

        // è§£æå†…å®¹
        async function parseContent() {
            showDebugInfo('å¼€å§‹è§£ææµç¨‹...');
            
            try {
                const input = document.getElementById('urlInput');
                if (!input) throw new Error('æ‰¾ä¸åˆ°è¾“å…¥æ¡†å…ƒç´ ');
                
                const url = extractURL(input.value);
                showDebugInfo(`æå–åˆ°URL: ${url || 'æ— '}`);

                if (!url) {
                    showAlert('ğŸš¨ è¯·è¾“å…¥æœ‰æ•ˆçš„é“¾æ¥å“¦ï½ (Â´â€¢Ì¥ Ì¯ â€¢Ì¥`)');
                    return;
                }

                toggleLoading(true);
                
                showDebugInfo(`æ­£åœ¨è¯·æ±‚API: ${url}`);
                const apiUrl = `https://api.kxzjoker.cn/api/jiexi_video?url=${encodeURIComponent(url)}`;
                const response = await fetch(apiUrl);
                showDebugInfo(`æ”¶åˆ°å“åº”çŠ¶æ€: ${response.status}`);

                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                showDebugInfo(`APIå“åº”æ•°æ®: ${JSON.stringify(data).slice(0, 100)}...`);

                if (!data || (data.success !== 200 && data.success !== true)) {
                    throw new Error('APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸');
                }

                renderContent(data.data);
                showDebugInfo('å†…å®¹æ¸²æŸ“å®Œæˆ');
            } catch (error) {
                console.error('è§£ææµç¨‹é”™è¯¯:', error);
                showDebugInfo(`é”™è¯¯: ${error.message}`);
                showAlert(`âŒ å‘ç”Ÿé”™è¯¯: ${error.message}`);
            } finally {
                toggleLoading(false);
            }
        }

        // æ¸²æŸ“å†…å®¹
        function renderContent(data) {
            const contentBox = document.getElementById('contentBox');
            if (!contentBox) {
                throw new Error('æ‰¾ä¸åˆ°å†…å®¹å®¹å™¨');
            }

            contentBox.innerHTML = '';
            
            try {
                if (data.images) {
                    const galleryHTML = data.images.map((img, index) => `
                        <div class="gallery-item" onclick="showFullImage('${img}')">
                            <img src="${img}" 
                                 alt="å›¾é›† ${index + 1}"
                                 loading="lazy"
                                 style="border-radius: 10px; 
                                        width: 100%; 
                                        aspect-ratio: 1/1; 
                                        object-fit: cover;
                                        cursor: zoom-in;">
                            <div class="image-index">${index + 1}</div>
                        </div>
                    `).join('');

                    contentBox.innerHTML = `
                        <div class="media-card">
                            <h2 style="color: #9370DB; margin-bottom: 15px;">
                                ${data.title || 'æœªå‘½åå›¾é›†'}
                            </h2>
                            <div style="display: grid; 
                                      gap: 10px; 
                                      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                                ${galleryHTML}
                            </div>
                        </div>
                    `;
                } else if (data.video_url) {
                    contentBox.innerHTML = `
                        <div class="media-card">
                            <h2 style="color: #9370DB; margin-bottom: 15px;">
                                ${data.video_title || 'æœªå‘½åè§†é¢‘'}
                            </h2>
                            <div style="position: relative; padding-top: 56.25%;">
                                <video controls 
                                       style="position: absolute;
                                              top: 0;
                                              left: 0;
                                              width: 100%;
                                              height: 100%;
                                              border-radius: 15px;">
                                    <source src="${data.video_url}" type="video/mp4">
                                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
                                </video>
                            </div>
                            <div style="margin-top: 15px; text-align: center;">
                                <a href="${data.download_url}" 
                                   style="display: inline-flex;
                                          align-items: center;
                                          padding: 12px 25px;
                                          background: #FFA1C9;
                                          color: white;
                                          border-radius: 25px;
                                          text-decoration: none;
                                          gap: 8px;">
                                    <i class="fas fa-download"></i>
                                    ä¿å­˜è§†é¢‘ (${(data.video_size || 0).toFixed(1)}MB)
                                </a>
                            </div>
                        </div>
                    `;
                }
                contentBox.style.opacity = 1;
            } catch (e) {
                console.error('æ¸²æŸ“é”™è¯¯:', e);
                showAlert('å†…å®¹æ¸²æŸ“å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼');
            }
        }

        // æ˜¾ç¤ºå®Œæ•´å›¾ç‰‡
        function showFullImage(url) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                cursor: zoom-out;
            `;
            
            const img = document.createElement('img');
            img.src = url;
            img.style.maxWidth = '90%';
            img.style.maxHeight = '90%';
            img.style.borderRadius = '10px';
            
            overlay.onclick = () => overlay.remove();
            overlay.appendChild(img);
            document.body.appendChild(overlay);
        }

        // å·¥å…·å‡½æ•°
        function toggleLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showAlert(message) {
            const alert = document.createElement('div');
            alert.style.position = 'fixed';
            alert.style.bottom = '30px';
            alert.style.left = '50%';
            alert.style.transform = 'translateX(-50%)';
            alert.style.background = 'rgba(255, 255, 255, 0.95)';
            alert.style.padding = '15px 30px';
            alert.style.borderRadius = '30px';
            alert.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.2)';
            alert.style.color = '#6A5ACD';
            alert.innerHTML = message;
            
            document.body.appendChild(alert);
            setTimeout(() => alert.remove(), 3000);
        }

        // ç¡®ä¿æŒ‰é’®ç‚¹å‡»äº‹ä»¶ç»‘å®š
        document.querySelector('.parse-btn').addEventListener('click', parseContent);
        document.querySelector('.parse-btn').addEventListener('touchend', parseContent);
    </script>
</body>
</html>
